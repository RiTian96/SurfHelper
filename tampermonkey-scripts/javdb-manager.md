# JavDB影片管理器

## 🔗 相关链接
- **GitHub仓库**: [https://github.com/RiTian96/SurfHelper](https://github.com/RiTian96/SurfHelper)
- **Greasy Fork**: [https://greasyfork.org/zh-CN/users/332142-ritian96](https://greasyfork.org/zh-CN/users/332142-ritian96)

## 📋 脚本介绍

JavDB 影片管理器是一款专为 JavDB 网站设计的智能影片管理工具，提供影片屏蔽、评分高亮、批量导入等功能，帮助用户更高效地管理和浏览影片内容。

## ✨ 主要功能

### 🎬 JavDB影片管理器 (v1.1.1)
- **已看影片屏蔽** - 自动识别并降低已看影片的透明度，避免重复浏览
- **想看影片屏蔽** - 标记想看影片，方便后续查找
- **低分影片过滤** - 智能屏蔽 3.5 分以下且评价人数超过 5 人的低质量影片
- **可视化开关控制** - 可独立控制各功能的开启/关闭

### 🌟 评分高亮系统
- **必看影片** - 5.0 分满分影片显示金色"必看"标记，带脉冲动画效果
- **推荐影片** - 4.5 分以上或 4.0 分以上且评价人数 ≥100 的影片显示绿色"推荐"标记
- **视觉区分** - 不同评分等级使用不同的高亮样式和边框效果
- **统一开关控制** - 低分屏蔽和高分高亮共用同一个开关，简化操作

### 📦 批量导入功能
- **智能导入** - 支持从已看/想看页面批量导入影片列表
- **URL翻页导入** - 直接使用URL+1方式翻页，更稳定可靠
- **智能停止机制** - 检测到"暫無內容"或无番号时自动停止
- **去重处理** - 同一番号只能在想看/已看中存在一个，按最后导入位置计算
- **进度追踪** - 实时显示导入进度和已导入数量
- **默认页码** - 导入按钮默认跳转到page=1开始导入

### 🔍 智能管理功能
- **快速搜索** - 智能搜索框支持模糊匹配影片番号
- **一键操作** - 快速添加/删除影片到已看或想看列表
- **悬浮面板** - 右上角最小化悬浮窗，点击展开完整管理界面
- **标签页设计** - 导入和管理功能分离，界面简洁清晰

## 🎯 核心特性

### 🛡️ 安全过滤
- **智能识别** - 准确识别影片番号，避免误匹配
- **安全机制** - 避免在链接、代码等元素中误操作
- **数据隔离** - 本地存储数据，不上传任何信息

### ⚡ 性能优化
- **实时监听** - 动态监听页面变化，自动应用屏蔽效果
- **智能缓存** - 优化数据处理，减少页面性能影响
- **异步处理** - 非阻塞式操作，不影响正常浏览

### 🎨 用户体验
- **响应式设计** - 适配各种屏幕尺寸
- **平滑动画** - 所有交互都有流畅的过渡效果
- **直观标记** - 清晰的视觉标记，一目了然

## 🚀 安装使用

### 安装步骤
1. 确保已安装 [Tampermonkey](https://www.tampermonkey.net/) 油猴插件
2. 点击 [🔧 安装脚本](https://raw.githubusercontent.com/RiTian96/SurfHelper/main/tampermonkey-scripts/javdb-manager.user.js)
3. 在弹出的页面中点击"安装"
4. 访问 JavDB 网站即可看到右上角的管理器图标

### 基础使用

#### 导入影片列表
1. 访问 JavDB 的「看过影片」或「想看影片」页面
2. 点击右上角的管理器图标展开面板
3. 选择对应的导入按钮（"导入看过"或"导入想看"）
4. 脚本会自动扫描当前页面并翻页导入
5. 导入完成后会在其他页面自动应用屏蔽效果

#### 管理影片
1. 在任意 JavDB 页面点击管理器图标
2. 切换到"管理"标签页
3. 在搜索框中输入影片番号进行搜索
4. 使用快捷按钮添加到已看或想看列表
5. 也可直接删除已存在的记录

#### 自定义设置
1. 在管理面板中找到功能开关区域
2. 根据需要开启/关闭以下功能：
   - 已看屏蔽 - 控制已看影片的透明度降低
   - 想看屏蔽 - 控制想看影片的透明度降低
   - 评分功能 - 统一控制低分屏蔽和高分高亮功能
3. 设置会自动保存，下次访问时保持配置
4. 开关状态实时生效，无需刷新页面

## 📋 版本历史

### v1.1.1 (2025-12-03) - 图标优化
- 添加目标网站favicon图标
- 新增谷歌图标服务作为备选方案
- 🚀 优化翻页逻辑，改用URL+1方式直接跳转，更稳定可靠
- 🛑 简化停止条件，仅检测"暫無內容"和无番号两种情况
- 🔄 改进去重机制，同一番号只能在想看/已看中存在一个，按最后导入位置计算
- 🎯 导入按钮默认跳转到page=1，确保从第一页开始导入
- 🗑️ 移除10秒无新数据自动停止机制，减少误判
- 🔧 修复翻页后继续导入的逻辑错误

### v1.0.0 (2025-12-03)
- 🎉 初始版本发布
- ✨ 实现已看/想看影片屏蔽功能
- ✨ 添加评分高亮系统（必看/推荐标记）
- ✨ 实现批量导入功能，支持翻页自动导入
- ✨ 添加智能搜索和管理界面
- ✨ 实现可视化开关控制
- ✨ 优化性能和用户体验
- 🔧 修复评分功能开关控制逻辑
- 🔧 优化导入进度显示，增加本页影片数量提示
- 🔧 修正调试信息显示准确性

## 🔧 技术细节

### 数据存储
- 使用 `GM_setValue`/`GM_getValue` 存储影片数据
- 支持跨页面数据同步
- 本地存储，保护用户隐私

### 匹配规则
- **已看/想看**：精确匹配影片番号
- **评分过滤**：解析评分格式 "X.XX分, 由XXX人评价"
- **智能容错**：支持多种评分格式解析，包括繁体中文和HTML编码
- **低分规则**：3.5分以下且评价人数>5人的影片自动变暗
- **高分规则**：5.0分必看，4.5分以上推荐，4.0-4.5分且≥100人评价推荐

### 兼容性
- 支持现代浏览器（Chrome、Firefox、Edge等）
- 适配 JavDB 网站的各种页面布局
- 响应式设计，支持移动端浏览

## ⚠️ 注意事项

1. **首次使用**：建议先导入已有的影片列表，以便享受完整的屏蔽功能
2. **评分过滤**：5人以下评价的影片不会被屏蔽，避免误判
3. **导入限制**：为避免性能问题，单次导入最多处理1000条记录
4. **数据备份**：重要数据建议定期备份，避免意外丢失
5. **评分功能**：低分屏蔽和高分高亮共用同一个开关，关闭后两者都会失效
6. **导入进度**：导入过程中会显示"本次导入数量 | 本页: X 个"的实时进度

## 🐛 问题反馈

如遇到问题或有功能建议，请通过以下方式联系：
- TG频道: https://t.me/SurfHelper_C
- TG群组: https://t.me/SurfHelper_G

## 📄 许可证

本项目采用 MIT 许可证，可自由使用、修改和分发。